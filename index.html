<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff6b35">
    <meta name="description" content="Control your iQE050 BBQ controller via Bluetooth">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>BBQ Controller</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="dark-mode">
    <!-- Header -->
    <header>
        <div class="header-content">
            <h1>üî• BBQ Controller</h1>
            <div class="header-controls">
                <button id="themeToggle" class="icon-btn" title="Toggle theme">üåô</button>
                <button id="connectBtn" class="primary-btn">Connect</button>
            </div>
        </div>
        <!-- Quick view: pit + food temps for at-a-glance status -->
        <div class="quick-view">
            <div class="quick-card temp-item" title="Tap to set">
                <div class="temp-label">Pit</div>
                <div class="temp-value" id="pitTemp">--¬∞F</div>
                <div class="temp-target" id="pitTarget">Target: --¬∞F</div>
            </div>
            <div class="quick-card temp-item" title="Tap to set">
                <div class="temp-label">Food 1</div>
                <div class="temp-value" id="food1Temp">--¬∞F</div>
                <div class="temp-target" id="food1Alarm">Alarm: Off</div>
            </div>
            <div class="quick-card temp-item" title="Tap to set">
                <div class="temp-label">Food 2</div>
                <div class="temp-value" id="food2Temp">--¬∞F</div>
                <div class="temp-target" id="food2Alarm">Alarm: Off</div>
            </div>
        </div>
        <div id="connectionStatus" class="status-bar disconnected">
            <span class="status-dot"></span>
            <span class="status-text">Disconnected</span>
        </div>
        <div id="lastEcho" class="status-echo">
            Last command: <span id="lastEchoText">--</span>
            <span id="lastEchoVerify" class="echo-verify">(no verification)</span>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Temperature History Chart -->
        <section class="card">
            <div class="section-header">
                <h2>üìä Temperature History</h2>
                <div class="graph-controls">
                    <button class="small-btn active" onclick="app.setGraphRange(30)">30m</button>
                    <button class="small-btn" onclick="app.setGraphRange(60)">1h</button>
                    <button class="small-btn" onclick="app.setGraphRange(120)">2h</button>
                </div>
            </div>
            <canvas id="tempChart"></canvas>
        </section>

        <!-- Status Overview -->
        <section class="card">
            <h2>‚öôÔ∏è System Status</h2>
            <div class="status-grid">
                <div class="status-item" data-action="set-fan">
                    <div class="status-icon">üí®</div>
                    <div class="status-label">Fan Speed</div>
                    <div class="status-value" id="fanSpeed">Auto</div>
                </div>
                <div class="status-item" data-action="set-lid">
                    <div class="status-icon">üîì</div>
                    <div class="status-label">Lid Detect</div>
                    <div class="status-value" id="lidDetect">Enabled</div>
                </div>
                <div class="status-item" data-action="set-units">
                    <div class="status-icon">üå°Ô∏è</div>
                    <div class="status-label">Units</div>
                    <div class="status-value" id="tempUnits">¬∞F</div>
                </div>
                <div class="status-item">
                    <div class="status-icon">‚è±Ô∏è</div>
                    <div class="status-label">Uptime</div>
                    <div class="status-value" id="uptime">--</div>
                </div>
                <div class="status-item" data-action="set-sound">
                    <div class="status-icon">üîä</div>
                    <div class="status-label">Sound</div>
                    <div class="status-value" id="soundLevel">3</div>
                </div>
                <div class="status-item" data-action="set-display">
                    <div class="status-icon">üí°</div>
                    <div class="status-label">Display</div>
                    <div class="status-value" id="displayLevel">3</div>
                </div>
            </div>
        </section>

        <!-- Fuel Monitor -->
        <section class="card">
            <h2>‚õΩ Fuel Monitor</h2>
            <div class="fuel-status">
                <div class="fuel-indicator">
                    <div class="fuel-bar">
                        <div class="fuel-bar-fill" id="fuelLevel" style="width: 100%"></div>
                    </div>
                    <div class="fuel-text" id="fuelText">Fuel OK</div>
                </div>
                <div class="fuel-details">
                    <div class="fuel-metric">
                        <span>Avg Fan Duty</span>
                        <strong id="avgFanDuty">--</strong>
                    </div>
                    <div class="fuel-metric">
                        <span>Temp Drop</span>
                        <strong id="tempDrop">--</strong>
                    </div>
                </div>
            </div>
        </section>

        <!-- Temperature Controls -->
        <section class="card">
            <h2>üéõÔ∏è Temperature Controls</h2>
            
            <div class="control-group">
                <label for="pitSetSlider">
                    <span>üî• Pit Target Temperature</span>
                    <span class="control-value" id="pitSetValue">225¬∞F</span>
                </label>
                <input type="range" id="pitSetSlider" min="150" max="400" value="225" step="5">
                <div class="range-labels">
                    <span>150¬∞F</span>
                    <span>400¬∞F</span>
                </div>
            </div>

            <div class="control-group">
                <label for="food1AlarmSlider">
                    <span>ü•© Food 1 Alarm</span>
                    <span class="control-value" id="food1AlarmValue">Off</span>
                </label>
                <input type="range" id="food1AlarmSlider" min="0" max="250" value="0" step="5">
                <div class="range-labels">
                    <span>Off</span>
                    <span>250¬∞F</span>
                </div>
            </div>

            <div class="control-group">
                <label for="food2AlarmSlider">
                    <span>üçñ Food 2 Alarm</span>
                    <span class="control-value" id="food2AlarmValue">Off</span>
                </label>
                <input type="range" id="food2AlarmSlider" min="0" max="250" value="0" step="5">
                <div class="range-labels">
                    <span>Off</span>
                    <span>250¬∞F</span>
                </div>
            </div>
        </section>

        <!-- Device Settings -->
        <section class="card">
            <h2>‚ö° Device Settings</h2>
            
            <div class="control-group">
                <label>üí® Fan Speed</label>
                <div class="button-group">
                    <button class="toggle-btn active" data-fan="0">Auto</button>
                    <button class="toggle-btn" data-fan="1">1</button>
                    <button class="toggle-btn" data-fan="2">2</button>
                    <button class="toggle-btn" data-fan="3">3</button>
                    <button class="toggle-btn" data-fan="4">4</button>
                    <button class="toggle-btn" data-fan="5">5</button>
                </div>
            </div>

            <div class="control-group">
                <label>üîì Lid Detect</label>
                <div class="button-group">
                    <button class="toggle-btn active" data-lid="1">On</button>
                    <button class="toggle-btn" data-lid="0">Off</button>
                </div>
            </div>

            <div class="control-group">
                <label>üå°Ô∏è Temperature Units</label>
                <div class="button-group">
                    <button class="toggle-btn active" data-units="0">¬∞F</button>
                    <button class="toggle-btn" data-units="1">¬∞C</button>
                </div>
            </div>

            <div class="control-group">
                <label for="soundSlider">
                    <span>üîä Sound Level</span>
                    <span class="control-value" id="soundValue">3</span>
                </label>
                <input type="range" id="soundSlider" min="0" max="5" value="3" step="1">
                <div class="range-labels">
                    <span>Off</span>
                    <span>5</span>
                </div>
            </div>

            <div class="control-group">
                <label for="displaySlider">
                    <span>üí° Display Brightness</span>
                    <span class="control-value" id="displayValue">3</span>
                </label>
                <input type="range" id="displaySlider" min="1" max="3" value="3" step="1">
                <div class="range-labels">
                    <span>1</span>
                    <span>3</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>BBQ Controller - Built for iQE050</p>
    </footer>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <!-- Modal Dialog -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Set Temperature</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-value-display">
                    <span id="modalValueDisplay">225</span>
                    <span id="modalValueUnit">¬∞F</span>
                </div>
                <input type="range" id="modalSlider" min="150" max="400" value="225" step="5">
                <div class="modal-range-labels">
                    <span id="modalMinLabel">150¬∞F</span>
                    <span id="modalMaxLabel">400¬∞F</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="modalCancel">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="modalConfirm">Set</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="bluetooth.js"></script>
    <script src="app.js"></script>
</body>
</html>
